<!doctype html>
<html lang="en">
	<meta charset="utf-8">
	<head>
		<script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
		<link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
		<style>
		  body { margin:0; padding:0; }
		  #map { position:absolute; top:0; bottom:0; width:100%; }
		</style>
	</head>
	<body>
		<div id='map'></div>
		<script>
			
		function getData(scope) {
			var columnNames = getWhatToGet(dataFields[scope]);
			var query = 'SELECT ' + columnNames + '  FROM ' + dataTableIDs[scope];
			getFusionTablesData(query, "parseData" + scope);
		}
		function getWhatToGet(columnNames){
		  	var whatToGet = "";
		  	for (var i = 0; i < columnNames.length; i++){
		  		whatToGet = whatToGet + columnNames[i].KEY + ", ";
		  	}
		  	whatToGet = whatToGet.substring(0, whatToGet.length - 2);
		  	return whatToGet;
	  	}
	  	function getFusionTablesData(query, callback){
		  	var script = document.createElement('script');
		  	var url = ['https://www.googleapis.com/fusiontables/v1/query?'];
		  	url.push('sql=');
		  	var encodedQuery = encodeURIComponent(query);
		  	url.push(encodedQuery);
		  	url.push('&callback=' + callback);
		  	url.push('&key=AIzaSyCyOfjR4LVvpwhsb4UfAT0AINBB19cbfUc');
		  	script.src = url.join('');
		  	var body = document.getElementsByTagName('body')[0];
		  	body.appendChild(script);
	  	} 
	  	function httpGet(theUrl)
		{
		    var xmlHttp = new XMLHttpRequest();
		    xmlHttp.open( "GET", theUrl, false );
		    xmlHttp.send( null );
		    return xmlHttp.responseText;
		}
	  	function showAlert(data){
	  		window.alert(JSON.stringify(data));
	  	}
		L.mapbox.accessToken = 'pk.eyJ1IjoiYnV6b2hlcmJlcnQiLCJhIjoibXJXclpEVSJ9.YxiPmO7Q5QZrOGCuOsAYQg';
		var map = new L.mapbox.map('map', 'buzoherbert.mn20inga').setView([1.339, 103.74], 18);
		var query = "https://www.googleapis.com/fusiontables/v2/tables/1d20ftB8iDjL29_rhxjNDEgy31bnFA2m99SFDOMCL/columns?key=AIzaSyCyOfjR4LVvpwhsb4UfAT0AINBB19cbfUc"		
		showAlert(httpGet(query));

		</script>
	</body>
</html>